/* 
 *	@author					Fernando R Gomez
 *	@company				SkyPlanner LLC
 *	@injected_code_author	William Garcia
 *	@description			spImage modal HTML and javascript injection
 * 	@date					5/26/2015
 */
$("body").append("<link rel=\"stylesheet\" type=\"text/css\" href=\"https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.css\"><style type=\"text/css\"> .hide{display: none !Important;}.image-modal{position: relative; display: none; width: 700px; top: 50px; display: none; -webkit-border-radius: 4px; -moz-border-radius: 4px; border-radius: 4px; background-color: white; border: 1px solid rgba(0, 0, 0, 0.3); -webkit-box-shadow: 0 0 10px rgba(0, 0, 0, 0.3); -moz-box-shadow: 0 0 10px rgba(0, 0, 0, 0.3); box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);}.image-modal .header{padding: 9px 15px; border-bottom: 1px solid #ddd; background-color: #f5f5f5; font-size: 1.2em; position: relative;}.image-modal .body{overflow: auto; max-height: 600px;}.image-modal h3{font-size: 1.2em;}.image-modal .header .close{cursor: pointer; font-size: 18px; font-weight: 700; line-height: 18px; color: #000; text-shadow: 0 1px 0 #fff; opacity: .2; filter: alpha(opacity=20); padding: 0; background: 0 0; border: 0; -webkit-appearance: none;}.image-modal .header span.fa{display: initial; position: absolute; top: 10px; right: 10px;}#image-modal #msg{height: 15px; padding: 10px; background-color: #fcf8e3; border: 1px solid #faebcc; color: #8a6d3b; margin: 10px; display: none; border-radius: 4px;}.image-modal .controls{height: 35px; text-align: center; padding-bottom: 10px;}.image-modal .img-container{position: relative; height: 380px; margin: 10px; overflow-x: hidden; overflow-y: hidden;}.image-modal .footer{padding: 10px; margin-bottom: 0; text-align: right; background-color: #f5f5f5; border-top: 1px solid #ddd;}.image-modal .footer .fa{font-size: 15px;}.image-modal .controls .fa{cursor: pointer; padding-right: 0px; font-size: 15px; color: #7f7f7f;}.image-modal .img-container img{max-height: 98%; max-width: 98%; top: 0; left: 0; right: 0; bottom: 0; margin: auto !important; position: absolute; border-radius: 4px;}.image-modal .fa.fa-spin{color: #7f7f7f; top: 49%; left: 49%; position: absolute; font-size: 18px;}.fa-btn{display: inline-block; margin-bottom: 0; font-weight: normal; text-align: center; vertical-align: middle; cursor: pointer; background-image: none; border: 1px solid transparent; white-space: nowrap; padding: 6px 10px; font-size: 14px; line-height: 1.42857143; border-radius: 4px; -webkit-user-select: none; font-size: 12px; color: #333333; background-color: #ffffff; border-color: #cccccc;}.fa-btn[disabled=\"disabled\"], .fa-btn.btn-success[disabled=\"disabled\"], .fa-btn.btn-default[disabled=\"disabled\"]{opacity: 0.3; color: black; background-color: #ffffff; border-color: #cccccc;}.fa-btn.btn-default{color: #7f7f7f;}.fa-btn.btn-success{color: #fff; background-color: #5cb85c; border-color: #4cae4c;}.fa-btn.btn-default:not([disabled]):hover{color: #333333; background-color: #ebebeb; border-color: #adadad;}.fa-btn.btn-success:not([disabled]):hover{color: #fff; background-color: #449d44; border-color: #398439;}.form-control{display: block;}input.form-control, textarea.form-control{width: 100%; padding: 6px 12px; font-size: 12px; line-height: 1.42857143; color: #555; background-color: #fff; background-image: none; border: 1px solid #ccc; border-radius: 4px; -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075); box-shadow: inset 0 1px 1px rgba(0,0,0,.075); -webkit-transition: border-color ease-in-out .15s,-webkit-box-shadow ease-in-out .15s; -o-transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s; transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s; box-sizing: border-box;}.image-modal .ops{margin: 10px 10px 0px 10px; color: #7f7f7f;}.image-modal .ops .pic-notes{overflow: auto;}.control-group{overflow: hidden; margin-bottom: 15px;}.control-label{float: left; width: 30px; font-weight: bold; color: black;}.control-right{margin-left: 45px;}</style><script type=\"text/javascript\">var eventMethod=window.addEventListener ? \"addEventListener\" : \"attachEvent\"; var eventer=window[eventMethod]; var messageEvent=eventMethod==\"attachEvent\" ? \"onmessage\" : \"message\"; var maxZ; var windowSource; $(document).ready(function (){spImageComponent.settingIframe(); spImageComponent.settingListener(); $('body').on('keyup', function (event){var target=$(event.target); if (!(target.is('input.form-control') || target.is('textarea.form-control'))){if (event.which==39) spImageComponent.passOnImage('next'); else if (event.which==37) spImageComponent.passOnImage('prev');}});}); var CONSTANTS={IS_AVAILABLE: 'available', SHOW_MODAL: 'show modal', CLOSE_MODAL: 'close modal', UPDATE_IMAGE: 'update image', UPDATE_NOTE: 'update note', DELETE_IMAGE: 'delete image'}; var spImageComponent={settingListener: function (){eventer(messageEvent, function (e){windowSource=e.source; data=JSON.parse(e.data); maxZ=spImageComponent.getMaxZIndex(); switch (data.action){case CONSTANTS.IS_AVAILABLE: windowSource.postMessage(JSON.stringify(data), \"*\"); break; case CONSTANTS.SHOW_MODAL: $(document.activeElement).blur(); spImageComponent.showModal(data); break; case CONSTANTS.CLOSE_MODAL: spImageComponent.closeModal(); break; case CONSTANTS.UPDATE_IMAGE: spImageComponent.updateModal(data); break;}}, false);}, settingIframe: function (){$('iframe').attr({allowfullscreen: '', webkitallowfullscreen: '', mozallowfullscreen: ''});}, showModal: function (data){spImageComponent.startLoading(); $(\"#image-modal-container\").css(\"z-index\", maxZ).removeClass('hide'); spImageComponent.updateModal(data);}, updateModal: function (data){var modal=$('#image-modal'); modal.css(\"left\", spImageComponent.calculatePosition($(window).width(), 350)); modal.find('.ops .pic-title').text(data.title); modal.find('.ops input').val(data.title); modal.find('.ops .pic-notes').text(data.note); modal.find('.ops textarea').val(data.note); modal.find('.parent-name').text(data.parentName); modal.find('.btn-save').addClass('hide'); modal.fadeIn('normal'); if (data.slideDisable) modal.find('.controls .fa-btn').attr('disabled', 'disabled'); else modal.find('.controls .fa-btn').removeAttr('disabled'); spImageComponent.shapeImage(data.imgData);}, shapeImage: function (src){var imgCont=$('#image-modal .img-container'); var img=imgCont.find('img'); img.removeAttr(\"src\"); img.attr(\"src\", src); img.load(function (){img.css({\"margin-top\": (-1) * img.height() / 2, \"margin-left\": (-1) * img.width() / 2}); imgCont.animate({opacity: 1}, \"fast\"); spImageComponent.stopLoading();});}, closeModal: function (){$('#image-modal .img-container img').removeAttr(\"src\"); spImageComponent.cancelEditing(); $('#image-modal-container').addClass('hide');}, getMaxZIndex: function (){var zindexArray=$.map($('body *'), function (e, n){var zindex=parseInt($(e).css('z-index')); if (($(e).css('position')=='absolute' || $(e).css('position')=='fixed') && !isNaN(zindex)){return zindex;}}); return Math.max.apply(null, zindexArray) + 1;}, calculatePosition: function (windowSize, elementSize){return (windowSize / 2 - elementSize) + \"px\";}, passOnImage: function (dir){spImageComponent.startLoading(); $('#image-modal .img-container img').removeAttr(\"src\"); var messageData={action: CONSTANTS.UPDATE_IMAGE, direction: dir}; windowSource.postMessage(JSON.stringify(messageData), \"*\");}, updateImage: function (){var messageData={action: CONSTANTS.UPDATE_NOTE, name: $('.ops input').val(), note: $('.ops textarea').val()}; windowSource.postMessage(JSON.stringify(messageData), \"*\"); var ops=$('#image-modal .ops'); ops.find('.pic-title').text(messageData.name); ops.find('.pic-notes').text(messageData.note); spImageComponent.cancelEditing();}, deleteImage: function (){windowSource.postMessage(JSON.stringify({action: CONSTANTS.DELETE_IMAGE}), \"*\");}, editing: function (){var ops=$('#image-modal .ops'); ops.find('.pic-title, .pic-notes').addClass('hide'); ops.find('input, textarea').removeClass('hide'); $('#btn-delete').hide(); $('#btn-edit').hide(); $('#btn-cancel').removeClass('hide'); $('#btn-save').removeClass('hide');}, cancelEditing: function (){var ops=$('#image-modal .ops'); ops.find('.pic-title, .pic-notes').removeClass('hide'); ops.find('input, textarea').addClass('hide'); $('#btn-cancel').addClass('hide'); $('#btn-edit').show(); $('#btn-save').addClass('hide'); $('#msg').hide().text(''); $('#btn-confirm').addClass('hide'); $('#btn-delete').show();}, showConfirm: function (msg, func){$('#msg').show().text(msg); $('#btn-edit').hide(); $('#btn-delete').hide(); $('#btn-cancel').removeClass('hide'); $('#btn-confirm').removeClass('hide').unbind(\"click\").click(function (){func(); $('#btn-edit').show(); $('#btn-confirm').addClass('hide'); $('#btn-cancel').addClass('hide'); $('#btn-delete').show(); $('#msg').hide().text('');});}, startLoading: function (){$('.fa-spin').show();}, stopLoading: function (selector){$('.fa-spin').hide();}};</script><div id=\"image-modal-container\" style=\"position: fixed; background: rgba(0, 0, 0, 0.8); width: 100%; height: 100%; left: 0; top: 0;\" class=\"hide\"> <div id=\"image-modal\" class=\"image-modal\"> <div class=\"header\"> <h3 class=\"parent-name\"></h3> <span class=\"fa\" onclick=\" spImageComponent.closeModal();\"> <button type=\"button\" class=\"close\">&times;</button> </span> </div><div class=\"body\"> <div id=\"msg\"> <span class=\"\"></span> </div><div class=\"img-container\"> <img> <span class=\"fa fa-circle-o-notch fa-spin\"></span> </div><div class=\"ops\"> <div class=\"controls\"> <button class=\"fa-btn btn-default\" onclick=\" spImageComponent.passOnImage('prev');\"> <span class=\"fa fa-chevron-left\"></span> </button> <button class=\"fa-btn btn-default\" onclick=\" spImageComponent.passOnImage('next');\"> <span class=\"fa fa-chevron-right\"></span> </button> </div><div class=\"control-group\"> <div class=\"control-label\">Title:</div><div class=\"control-right\"> <span class=\"pic-title\"></span> <input type=\"text\" class=\"form-control hide\" onchange=\" $(this).parent().removeClass('error');\"> </div></div><div class=\"control-group\"> <div class=\"control-label\">Notes:</div><div class=\"control-right\"> <span class=\"form-control pic-notes\"></span> <textarea rows=\"3\" class=\"form-control hide\"></textarea> </div></div></div></div><div class=\"footer\"> <button id=\"btn-edit\" class=\"fa-btn btn-default\" onclick=\" spImageComponent.editing();\">Edit</button> <button id=\"btn-save\" class=\"fa-btn btn-success hide\" onclick=\" spImageComponent.updateImage();\">Save</button> <button id=\"btn-delete\" class=\"fa-btn btn-default\" onclick=\" spImageComponent.showConfirm('This image will be permanently deleted. Are you sure?', spImageComponent.deleteImage);\">Delete</button> <button id=\"btn-confirm\" class=\"fa-btn btn-success hide\">Confirm</button> <button id=\"btn-cancel\" class=\"fa-btn btn-default hide\" onclick=\" spImageComponent.cancelEditing();\">Cancel</button> <button class=\"fa-btn btn-default\" onclick=\" spImageComponent.closeModal();\">Close</button> </div></div></div>");