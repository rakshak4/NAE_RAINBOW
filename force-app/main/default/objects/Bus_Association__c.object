<?xml version="1.0" encoding="UTF-8"?>
<CustomObject xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionOverrides>
        <actionName>Accept</actionName>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Accept</actionName>
        <formFactor>Large</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Accept</actionName>
        <formFactor>Small</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>CancelEdit</actionName>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>CancelEdit</actionName>
        <formFactor>Large</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>CancelEdit</actionName>
        <formFactor>Small</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Clone</actionName>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Clone</actionName>
        <formFactor>Large</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Clone</actionName>
        <formFactor>Small</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Delete</actionName>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Delete</actionName>
        <formFactor>Large</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Delete</actionName>
        <formFactor>Small</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Edit</actionName>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Edit</actionName>
        <formFactor>Large</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Edit</actionName>
        <formFactor>Small</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>List</actionName>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>List</actionName>
        <formFactor>Large</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>List</actionName>
        <formFactor>Small</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>New</actionName>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>New</actionName>
        <formFactor>Large</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>New</actionName>
        <formFactor>Small</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>SaveEdit</actionName>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>SaveEdit</actionName>
        <formFactor>Large</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>SaveEdit</actionName>
        <formFactor>Small</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Tab</actionName>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Tab</actionName>
        <formFactor>Large</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>Tab</actionName>
        <formFactor>Small</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>View</actionName>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>View</actionName>
        <formFactor>Large</formFactor>
        <type>Default</type>
    </actionOverrides>
    <actionOverrides>
        <actionName>View</actionName>
        <formFactor>Small</formFactor>
        <type>Default</type>
    </actionOverrides>
    <allowInChatterGroups>false</allowInChatterGroups>
    <compactLayoutAssignment>SYSTEM</compactLayoutAssignment>
    <deploymentStatus>Deployed</deploymentStatus>
    <enableActivities>true</enableActivities>
    <enableBulkApi>true</enableBulkApi>
    <enableFeeds>false</enableFeeds>
    <enableHistory>false</enableHistory>
    <enableLicensing>false</enableLicensing>
    <enableReports>true</enableReports>
    <enableSearch>true</enableSearch>
    <enableSharing>true</enableSharing>
    <enableStreamingApi>true</enableStreamingApi>
    <externalSharingModel>ControlledByParent</externalSharingModel>
    <fields>
        <fullName>Allow_Delete__c</fullName>
        <externalId>false</externalId>
        <formula>OR(Has_Been_Current__c = FALSE, $Profile.Name = &quot;System Administrator&quot;)</formula>
        <formulaTreatBlanksAs>BlankAsZero</formulaTreatBlanksAs>
        <label>Allow Delete</label>
        <trackTrending>false</trackTrending>
        <type>Checkbox</type>
    </fields>
    <fields>
        <fullName>Bus_Capacity__c</fullName>
        <externalId>false</externalId>
        <formula>Bus_Stop__r.Bus_Route__r.Seat_Capacity__c</formula>
        <formulaTreatBlanksAs>BlankAsZero</formulaTreatBlanksAs>
        <label>Bus Capacity</label>
        <precision>18</precision>
        <required>false</required>
        <scale>0</scale>
        <trackTrending>false</trackTrending>
        <type>Number</type>
        <unique>false</unique>
    </fields>
    <fields>
        <fullName>Bus_Comment__c</fullName>
        <externalId>false</externalId>
        <label>Bus Comment</label>
        <length>70</length>
        <required>false</required>
        <trackTrending>false</trackTrending>
        <type>Text</type>
        <unique>false</unique>
    </fields>
    <fields>
        <fullName>Bus_Route_Copy__c</fullName>
        <externalId>false</externalId>
        <label>Bus Route Copy</label>
        <length>5</length>
        <required>false</required>
        <trackTrending>false</trackTrending>
        <type>Text</type>
        <unique>false</unique>
    </fields>
    <fields>
        <fullName>Bus_Route__c</fullName>
        <externalId>false</externalId>
        <formula>Bus_Stop__r.Bus_Route__r.Name</formula>
        <formulaTreatBlanksAs>BlankAsZero</formulaTreatBlanksAs>
        <label>Bus Route#</label>
        <required>false</required>
        <trackTrending>false</trackTrending>
        <type>Text</type>
        <unique>false</unique>
    </fields>
    <fields>
        <fullName>Bus_Stop__c</fullName>
        <externalId>false</externalId>
        <label>Bus Stop</label>
        <referenceTo>Bus_Stops__c</referenceTo>
        <relationshipLabel>Bus Service</relationshipLabel>
        <relationshipName>Bus_Associations</relationshipName>
        <relationshipOrder>1</relationshipOrder>
        <reparentableMasterDetail>true</reparentableMasterDetail>
        <trackTrending>false</trackTrending>
        <type>MasterDetail</type>
        <writeRequiresMasterRead>false</writeRequiresMasterRead>
    </fields>
    <fields>
        <fullName>Comments_Starting_Dates__c</fullName>
        <description>Adds a starting and leaving date to the comments, if the child is leaving or starting in the next 30 days.</description>
        <externalId>false</externalId>
        <formula>IF(AND( Student__r.Starting_Date_30__c =&quot;TRUE&quot;,Student__r.CloseDate&gt;TODAY()),&quot;Student Starting: &quot;&amp;  Student_Starting_Date__c &amp;&quot; &quot;&amp; Bus_Comment__c, IF( Student__r.Leaving_Date_30__c =&quot;TRUE&quot;,&quot;Student Leaving: &quot;&amp;  Student_Leaving_Date__c &amp;&quot; &quot;&amp; Bus_Comment__c,Bus_Comment__c))</formula>
        <formulaTreatBlanksAs>BlankAsZero</formulaTreatBlanksAs>
        <label>Comments + Dates</label>
        <required>false</required>
        <trackTrending>false</trackTrending>
        <type>Text</type>
        <unique>false</unique>
    </fields>
    <fields>
        <fullName>Copy_Student_Leaving_Date__c</fullName>
        <externalId>false</externalId>
        <formula>Student__r.Leaving_Date__c</formula>
        <formulaTreatBlanksAs>BlankAsZero</formulaTreatBlanksAs>
        <label>Copy Student Leaving Date</label>
        <required>false</required>
        <trackTrending>false</trackTrending>
        <type>Date</type>
    </fields>
    <fields>
        <fullName>Copy_Student_Start_Date__c</fullName>
        <externalId>false</externalId>
        <formula>Student__r.CloseDate</formula>
        <formulaTreatBlanksAs>BlankAsZero</formulaTreatBlanksAs>
        <label>Copy Student Start Date</label>
        <required>false</required>
        <trackTrending>false</trackTrending>
        <type>Date</type>
    </fields>
    <fields>
        <fullName>External_ID_18_Char__c</fullName>
        <caseSensitive>false</caseSensitive>
        <description>The ID of the record in the alternate SFDC org, where applicable.</description>
        <externalId>true</externalId>
        <label>External ID (18 Char)</label>
        <length>18</length>
        <required>false</required>
        <trackTrending>false</trackTrending>
        <type>Text</type>
        <unique>true</unique>
    </fields>
    <fields>
        <fullName>Fee_Charged__c</fullName>
        <externalId>false</externalId>
        <formula>Bus_Stop__r.Bus_Route__r.Yearly_Bus_Fee__c * of_Fee_Charged__c</formula>
        <formulaTreatBlanksAs>BlankAsZero</formulaTreatBlanksAs>
        <label>Fee Charged</label>
        <precision>18</precision>
        <required>false</required>
        <scale>2</scale>
        <trackTrending>false</trackTrending>
        <type>Currency</type>
    </fields>
    <fields>
        <fullName>First_Date_of_Use__c</fullName>
        <externalId>false</externalId>
        <label>First Date of Use</label>
        <required>true</required>
        <trackTrending>false</trackTrending>
        <type>Date</type>
    </fields>
    <fields>
        <fullName>Has_Been_Current__c</fullName>
        <defaultValue>false</defaultValue>
        <description>Used in the formula field which defines when a bus service can be deleted</description>
        <externalId>false</externalId>
        <label>Has Been Current</label>
        <trackTrending>false</trackTrending>
        <type>Checkbox</type>
    </fields>
    <fields>
        <fullName>Invalid_Bus_Service__c</fullName>
        <externalId>false</externalId>
        <formula>First_Date_of_Use__c &lt; Student__r.CloseDate</formula>
        <formulaTreatBlanksAs>BlankAsZero</formulaTreatBlanksAs>
        <label>Invalid Bus Service</label>
        <trackTrending>false</trackTrending>
        <type>Checkbox</type>
    </fields>
    <fields>
        <fullName>Is_Current_Check_Formula__c</fullName>
        <description>Used as a check to make sure the value in the Is_Current__c field is correct</description>
        <externalId>false</externalId>
        <formula>AND( 
    First_Date_of_Use__c &lt;= TODAY(), 
    OR(
       TEXT(Student__r.Leaving_Date__c) = &quot;&quot;,
       Student__r.Leaving_Date__c &gt;= TODAY()
       ),
    OR( 
       Last_Date_of_Use__c &gt;= TODAY(), 
       TEXT(Last_Date_of_Use__c) = &quot;&quot; 
       ) 
    )</formula>
        <formulaTreatBlanksAs>BlankAsZero</formulaTreatBlanksAs>
        <label>Is Current (Check Formula)</label>
        <trackTrending>false</trackTrending>
        <type>Checkbox</type>
    </fields>
    <fields>
        <fullName>Is_Current_Checkbox__c</fullName>
        <defaultValue>false</defaultValue>
        <externalId>false</externalId>
        <label>Is Current (Checkbox)</label>
        <trackTrending>false</trackTrending>
        <type>Checkbox</type>
    </fields>
    <fields>
        <fullName>Is_Current__c</fullName>
        <description>The field visible to users and used in reports. Reflects the value in Is_Current_Checkbox__c except in cases where a student&apos;s leaving date is before the &apos;Last Date of Use&apos; of a bus service.</description>
        <externalId>false</externalId>
        <formula>IF(Copy_Student_Leaving_Date__c &lt; TODAY(), FALSE, Is_Current_Checkbox__c)</formula>
        <formulaTreatBlanksAs>BlankAsZero</formulaTreatBlanksAs>
        <label>Is Current</label>
        <trackTrending>false</trackTrending>
        <type>Checkbox</type>
    </fields>
    <fields>
        <fullName>Last_Date_of_Use_1__c</fullName>
        <description>Required in a time trigger to make bus services non-current before the end of the last day they are being used.</description>
        <externalId>false</externalId>
        <formula>Last_Date_of_Use__c + 1</formula>
        <formulaTreatBlanksAs>BlankAsZero</formulaTreatBlanksAs>
        <label>Last Date of Use +1</label>
        <required>false</required>
        <trackTrending>false</trackTrending>
        <type>Date</type>
    </fields>
    <fields>
        <fullName>Last_Date_of_Use__c</fullName>
        <externalId>false</externalId>
        <label>Last Date of Use</label>
        <required>false</required>
        <trackTrending>false</trackTrending>
        <type>Date</type>
    </fields>
    <fields>
        <fullName>Mass_Update__c</fullName>
        <defaultValue>false</defaultValue>
        <externalId>false</externalId>
        <label>Mass Update</label>
        <trackTrending>false</trackTrending>
        <type>Checkbox</type>
    </fields>
    <fields>
        <fullName>Parent_Company_Paying__c</fullName>
        <deleteConstraint>SetNull</deleteConstraint>
        <description>The parent/company responsible for payment of bus fees</description>
        <externalId>false</externalId>
        <label>Parent/Company Paying</label>
        <referenceTo>Account</referenceTo>
        <relationshipLabel>Bus Services Payable</relationshipLabel>
        <relationshipName>Bus_Service</relationshipName>
        <required>false</required>
        <trackTrending>false</trackTrending>
        <type>Lookup</type>
    </fields>
    <fields>
        <fullName>School__c</fullName>
        <externalId>false</externalId>
        <formula>TEXT(Student__r.Owner.School__c)</formula>
        <formulaTreatBlanksAs>BlankAsZero</formulaTreatBlanksAs>
        <label>School</label>
        <required>false</required>
        <trackTrending>false</trackTrending>
        <type>Text</type>
        <unique>false</unique>
    </fields>
    <fields>
        <fullName>Student_Leaving_Date__c</fullName>
        <externalId>false</externalId>
        <formula>Student__r.Copy_Leaving_Date_Format__c</formula>
        <formulaTreatBlanksAs>BlankAsZero</formulaTreatBlanksAs>
        <label>Student Leaving Date</label>
        <required>false</required>
        <trackTrending>false</trackTrending>
        <type>Text</type>
        <unique>false</unique>
    </fields>
    <fields>
        <fullName>Student_Starting_Date__c</fullName>
        <externalId>false</externalId>
        <formula>Student__r.Copy_Starting_Date_Format__c</formula>
        <formulaTreatBlanksAs>BlankAsZero</formulaTreatBlanksAs>
        <label>Student Starting Date</label>
        <required>false</required>
        <trackTrending>false</trackTrending>
        <type>Text</type>
        <unique>false</unique>
    </fields>
    <fields>
        <fullName>Student__c</fullName>
        <externalId>false</externalId>
        <label>Student</label>
        <referenceTo>Opportunity</referenceTo>
        <relationshipName>Bus_Associations</relationshipName>
        <relationshipOrder>0</relationshipOrder>
        <reparentableMasterDetail>false</reparentableMasterDetail>
        <trackTrending>false</trackTrending>
        <type>MasterDetail</type>
        <writeRequiresMasterRead>false</writeRequiresMasterRead>
    </fields>
    <fields>
        <fullName>of_Fee_Charged__c</fullName>
        <defaultValue>1</defaultValue>
        <externalId>false</externalId>
        <label>% of Fee Charged</label>
        <precision>18</precision>
        <required>false</required>
        <scale>0</scale>
        <trackTrending>false</trackTrending>
        <type>Percent</type>
    </fields>
    <label>Bus Service</label>
    <nameField>
        <displayFormat>A-{0000}</displayFormat>
        <label>Bus Service</label>
        <type>AutoNumber</type>
    </nameField>
    <pluralLabel>Bus Service</pluralLabel>
    <searchLayouts>
        <lookupDialogsAdditionalFields>Student__c</lookupDialogsAdditionalFields>
        <lookupDialogsAdditionalFields>Bus_Route__c</lookupDialogsAdditionalFields>
        <lookupDialogsAdditionalFields>Bus_Stop__c</lookupDialogsAdditionalFields>
    </searchLayouts>
    <sharingModel>ControlledByParent</sharingModel>
    <validationRules>
        <fullName>First_Date_of_Use_After_Stud_Start_Date</fullName>
        <active>true</active>
        <errorConditionFormula>Student__r.CloseDate &gt; First_Date_of_Use__c</errorConditionFormula>
        <errorMessage>The &apos;First Date of Use&apos; cannot be before the student&apos;s &apos;Starting Date&apos; at school</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>First_Date_of_Use_B4_Last_Date_Of_Use</fullName>
        <active>true</active>
        <errorConditionFormula>First_Date_of_Use__c &gt; Last_Date_of_Use__c</errorConditionFormula>
        <errorMessage>The bus service first date of use cannot be after the bus service last date of use</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>Prevent_First_Date_of_Use_Change</fullName>
        <active>true</active>
        <description>Prevents a change in the &apos;First Date of Use&apos; of a student which could be an effort to bypass the auto-auditing system.</description>
        <errorConditionFormula>AND(
    OR(
       ISPICKVAL(Student__r.StageName, &quot;Enrolled&quot;),
       ISPICKVAL(Student__r.StageName, &quot;Left&quot;),
       AND(
           ISPICKVAL(Student__r.StageName, &quot;A/ Deposit&quot;),
           ISPICKVAL(Student__r.Add_to_Register__c, &quot;Yes&quot;)
           )
       ),
    ISCHANGED(First_Date_of_Use__c),
    PRIORVALUE(First_Date_of_Use__c)+7 &lt; TODAY(),
    PRIORVALUE(First_Date_of_Use__c) &lt; First_Date_of_Use__c, 
    $Profile.Name != &quot;System Administrator&quot; 
    )</errorConditionFormula>
        <errorMessage>You cannot change the &apos;First Date of Use&apos; of a bus service to a later date if their &apos;First Date of Use&apos; is 7 or more days in the past. Please contact group admin if you require further assistance.</errorMessage>
    </validationRules>
    <validationRules>
        <fullName>Prevent_Multiple_Current_Bus_Services</fullName>
        <active>true</active>
        <errorConditionFormula>AND(Student__r.Count_Current_Bus_Services__c &gt; 1,   Is_Current_Check_Formula__c = TRUE)</errorConditionFormula>
        <errorMessage>You cannot have multiple current bus services</errorMessage>
    </validationRules>
    <visibility>Public</visibility>
</CustomObject>
